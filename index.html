<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Classroom Projector Quiz</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* Hide scrollbars for projector cleanliness */
        body { overflow: hidden; background-color: #f8fafc; }
        /* Prevent text selection */
        .no-select { user-select: none; -webkit-user-select: none; }
        
        /* Custom Animations */
        @keyframes bounce-slow {
            0%, 100% { transform: translateY(-5%); }
            50% { transform: translateY(5%); }
        }
        .animate-bounce-slow { animation: bounce-slow 3s infinite; }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/"
  }
}
</script>
</head>
<body class="no-select">
    <div id="root"></div>

    <script type="text/babel" data-presets="react,typescript">
    const { useState, useEffect, useRef } = React;

    // --- ICONS (Embedded for reliability) ---
    const IconVolume2 = ({className}) => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>
    );
    const IconCheck = ({className}) => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="4" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12"/></svg>
    );
    const IconX = ({className}) => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="4" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
    );
    const IconHeart = ({className}) => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
    );
    const IconArrowLeft = ({className}) => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
    );
    const IconEraser = ({className}) => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"/><path d="M22 21H7"/><path d="m5 11 9 9"/></svg>
    );
    const IconHome = ({className}) => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    );
    const IconFlame = ({className}) => (
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" className={className}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>
    );

    // --- DATA ---
    function shuffle(array) {
        return [...array].sort(() => Math.random() - 0.5);
    }

    const TRAFFIC_LEVELS = [
        {
            id: 'a1', type: 'color_reaction', prompt: "Tap the correct color!", commandText: "The light is red.", targetColor: 'red', audioPrompt: "The light is red."
        },
        {
            id: 'a2', type: 'picture_choice', prompt: "What does this mean?", iconType: 'green_light',
            options: shuffle([
                { id: 'o1', text: "Look! It's green now.", isCorrect: true },
                { id: 'o2', text: "Stop! Red light.", isCorrect: false },
                { id: 'o3', text: "Good morning.", isCorrect: false }
            ])
        },
        {
            id: 'a3', type: 'build', targetSentence: "Let‚Äôs go to school.", chinese: "Êàë‰ª¨ÂéªÂ≠¶Ê†°Âêß„ÄÇ",
            words: shuffle(["Let‚Äôs", "go", "to", "school.", "stop"])
        },
        {
            id: 'a4', type: 'color_reaction', prompt: "Fast!", commandText: "Let's go!", targetColor: 'green', audioPrompt: "Let's go!"
        },
        {
            id: 'a5', type: 'match_pairs', prompt: "Match English and Chinese",
            pairs: shuffle([
                { id: 'p1a', text: "Good morning.", lang: 'en', pairId: 'p1' },
                { id: 'p1b', text: "Êó©‰∏äÂ•Ω„ÄÇ", lang: 'cn', pairId: 'p1' },
                { id: 'p2a', text: "Stop!", lang: 'en', pairId: 'p2' },
                { id: 'p2b', text: "ÂÅúÔºÅ", lang: 'cn', pairId: 'p2' },
                { id: 'p3a', text: "It's green now.", lang: 'en', pairId: 'p3' },
                { id: 'p3b', text: "Áé∞Âú®ÊòØÁªøÁÅØ‰∫Ü„ÄÇ", lang: 'cn', pairId: 'p3' }
            ])
        },
        {
            id: 'a6', type: 'build', targetSentence: "The light is red.", chinese: "Á∫¢ÁÅØ‰∫Æ‰∫Ü„ÄÇ",
            words: shuffle(["The", "light", "is", "red.", "green"])
        }
    ];

    const ALPHABET_LEVELS = [
        {
            id: 'b1', type: 'audio_choice', prompt: "Which letter is Q?", audioText: "Find the letter Q.",
            options: shuffle([{ id: 'opt1', text: "Q", isCorrect: true }, { id: 'opt2', text: "P", isCorrect: false }, { id: 'opt3', text: "O", isCorrect: false }])
        },
        { id: 'b2', type: 'tracing', prompt: "Trace Uppercase Q", letter: "Q" },
        {
            id: 'b3', type: 'match_pairs', prompt: "Match Big and Small",
            pairs: shuffle([
                { id: 'p1a', text: "Q", lang: 'en', pairId: 'p1' }, { id: 'p1b', text: "q", lang: 'en', pairId: 'p1' },
                { id: 'p2a', text: "R", lang: 'en', pairId: 'p2' }, { id: 'p2b', text: "r", lang: 'en', pairId: 'p2' },
                { id: 'p3a', text: "rabbit", lang: 'en', pairId: 'p3' }, { id: 'p3b', text: "üê∞", lang: 'image', pairId: 'p3' }
            ])
        },
        { id: 'b4', type: 'tracing', prompt: "Trace Lowercase q", letter: "q" },
        {
            id: 'b7', type: 'picture_choice', prompt: "Choose the word", iconType: 'question',
            options: shuffle([{ id: 'o1', text: "question", isCorrect: true }, { id: 'o2', text: "rabbit", isCorrect: false }, { id: 'o3', text: "queen", isCorrect: false }])
        },
        { id: 'b6', type: 'tracing', prompt: "Trace Uppercase R", letter: "R" },
        {
            id: 'b9', type: 'build', targetSentence: "rabbit", chinese: "ÂÖîÂ≠ê",
            words: shuffle(["r", "a", "b", "b", "i", "t"])
        },
        {
            id: 'b10', type: 'missing_letter', prompt: "Complete the word", displayWord: "_uestion", correctOption: "q",
            options: shuffle(["q", "p", "d"])
        }
    ];

    const MODULES = [
        { id: 'mod_traffic', title: "Traffic Light", description: "Unit 3", themeColor: "bg-blue-500", levels: TRAFFIC_LEVELS },
        { id: 'mod_alpha', title: "Alphabet (Qq-Rr)", description: "Unit 4", themeColor: "bg-purple-500", levels: ALPHABET_LEVELS }
    ];

    // --- AUDIO ENGINE ---
    const AudioEngine = {
        playDing: () => {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.type = 'sine';
                osc.frequency.setValueAtTime(523.25, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1046.5, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.5, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                osc.start();
                osc.stop(ctx.currentTime + 0.3);
            } catch(e) {}
        },
        playBoop: () => {
             try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(200, ctx.currentTime); 
                osc.frequency.linearRampToValueAtTime(150, ctx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.5, ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                osc.start();
                osc.stop(ctx.currentTime + 0.3);
             } catch(e) {}
        },
        speak: (text) => {
            if (!window.speechSynthesis) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.8; 
            window.speechSynthesis.speak(utterance);
        }
    };

    // --- JUMBO COMPONENTS ---
    const TrafficLightRed = () => (
        <div className="w-32 h-48 bg-slate-800 rounded-3xl flex flex-col items-center justify-center gap-3 p-3 border-4 border-slate-600">
            <div className="w-10 h-10 rounded-full bg-red-500 shadow-[0_0_50px_rgba(239,68,68,1)] animate-pulse" />
            <div className="w-10 h-10 rounded-full bg-slate-700/50" />
            <div className="w-10 h-10 rounded-full bg-slate-700/50" />
        </div>
    );
    const TrafficLightGreen = () => (
        <div className="w-32 h-48 bg-slate-800 rounded-3xl flex flex-col items-center justify-center gap-3 p-3 border-4 border-slate-600">
            <div className="w-10 h-10 rounded-full bg-slate-700/50" />
            <div className="w-10 h-10 rounded-full bg-slate-700/50" />
            <div className="w-10 h-10 rounded-full bg-green-500 shadow-[0_0_50px_rgba(34,197,94,1)] animate-pulse" />
        </div>
    );

    // --- MAIN APP ---
    const App = () => {
        const [view, setView] = useState('HOME');
        const [activeModule, setActiveModule] = useState(null);
        const [levelIndex, setLevelIndex] = useState(0);
        const [hearts, setHearts] = useState(5);
        const [status, setStatus] = useState('idle');
        const [progress, setProgress] = useState(0);
        const [isFinished, setIsFinished] = useState(false);
        
        // Game States
        const [buildSelectedWords, setBuildSelectedWords] = useState([]);
        const [matchPairsSolved, setMatchPairsSolved] = useState([]);
        const [matchSelectedId, setMatchSelectedId] = useState(null);
        const [choiceSelectedId, setChoiceSelectedId] = useState(null);
        const [canvasHasDrawing, setCanvasHasDrawing] = useState(false);

        const canvasRef = useRef(null);
        const isDrawing = useRef(false);
        const currentLevel = activeModule ? activeModule.levels[levelIndex] : null;

        useEffect(() => {
            if (!currentLevel) return;
            setStatus('idle');
            setBuildSelectedWords([]);
            setMatchPairsSolved([]);
            setMatchSelectedId(null);
            setChoiceSelectedId(null);
            setCanvasHasDrawing(false);
            
            if (currentLevel.audioPrompt) setTimeout(() => AudioEngine.speak(currentLevel.audioPrompt), 600);
            else if (currentLevel.type === 'audio_choice') setTimeout(() => AudioEngine.speak(currentLevel.audioText), 600);
            else if (currentLevel.type === 'tracing') setTimeout(() => AudioEngine.speak(`Let's write ${currentLevel.letter}`), 600);
        }, [levelIndex, currentLevel]);

        // Match Logic
        useEffect(() => {
            if (currentLevel?.type === 'match_pairs' && status === 'idle') {
                if (matchPairsSolved.length === currentLevel.pairs.length && matchPairsSolved.length > 0) handleSuccess();
            }
        }, [matchPairsSolved]);

        const startModule = (mod) => {
            setActiveModule(mod);
            setLevelIndex(0);
            setHearts(5);
            setProgress(0);
            setIsFinished(false);
            setView('GAME');
        };

        const handleSuccess = () => {
            setStatus('correct');
            AudioEngine.playDing();
            if (currentLevel?.type === 'build') AudioEngine.speak(currentLevel.targetSentence);
            if (currentLevel?.type === 'picture_choice') {
                const opt = currentLevel.options.find(o => o.isCorrect);
                if(opt) AudioEngine.speak(opt.text);
            }
        };

        const handleError = () => {
            setStatus('wrong');
            AudioEngine.playBoop();
            setHearts(h => Math.max(0, h - 1));
        };

        const handleNextLevel = () => {
            if (levelIndex < activeModule.levels.length - 1) {
                setLevelIndex(prev => prev + 1);
                setProgress(((levelIndex + 2) / (activeModule.levels.length + 1)) * 100);
            } else {
                setIsFinished(true);
                setProgress(100);
                AudioEngine.playDing();
            }
        };

        const checkAnswer = () => {
            if (status !== 'idle') {
                handleNextLevel();
                return;
            }
            let correct = false;
            switch (currentLevel.type) {
                case 'build':
                    correct = buildSelectedWords.map(w=>w.text).join(currentLevel.targetSentence.includes(' ') ? ' ' : '') === currentLevel.targetSentence;
                    break;
                case 'match_pairs':
                    correct = matchPairsSolved.length === currentLevel.pairs.length;
                    break;
                case 'audio_choice':
                case 'picture_choice':
                    const opt = currentLevel.options.find(o => o.id === choiceSelectedId);
                    correct = opt?.isCorrect || false;
                    break;
                case 'tracing':
                    correct = canvasHasDrawing;
                    break;
                case 'missing_letter':
                    correct = choiceSelectedId === currentLevel.correctOption;
                    break;
            }
            if (correct) handleSuccess();
            else handleError();
        };

        // Canvas Logic
        const startDrawing = (e) => {
            if(!canvasRef.current) return;
            isDrawing.current = true;
            const ctx = canvasRef.current.getContext('2d');
            ctx.lineWidth = 30; ctx.lineCap = 'round'; ctx.strokeStyle = '#2563eb';
            const { offsetX, offsetY } = getCoordinates(e);
            ctx.beginPath(); ctx.moveTo(offsetX, offsetY);
            setCanvasHasDrawing(true);
        };
        const draw = (e) => {
            if(!isDrawing.current) return;
            const { offsetX, offsetY } = getCoordinates(e);
            const ctx = canvasRef.current.getContext('2d');
            ctx.lineTo(offsetX, offsetY); ctx.stroke();
        };
        const stopDrawing = () => { isDrawing.current = false; };
        const getCoordinates = (e) => {
            const rect = canvasRef.current.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            const scaleX = canvasRef.current.width / rect.width;
            const scaleY = canvasRef.current.height / rect.height;
            return { offsetX: (clientX - rect.left) * scaleX, offsetY: (clientY - rect.top) * scaleY };
        };

        // --- VIEWS ---

        if (view === 'HOME') {
            return (
                <div className="h-screen w-screen flex flex-col items-center justify-center bg-slate-50 gap-8">
                    <h1 className="text-7xl font-black text-slate-800">English Quiz</h1>
                    <div className="flex gap-8 w-full max-w-6xl px-8 h-[60vh]">
                        {MODULES.map(mod => (
                            <button key={mod.id} onClick={() => startModule(mod)} className="flex-1 bg-white rounded-[3rem] border-8 border-slate-200 shadow-xl flex flex-col items-center justify-center gap-6 hover:border-blue-400 active:scale-95 transition-all">
                                <div className={`w-32 h-32 ${mod.themeColor} rounded-full flex items-center justify-center text-white text-6xl shadow-inner`}>
                                    {mod.id === 'mod_traffic' ? 'üö•' : 'Aa'}
                                </div>
                                <div className="text-center">
                                    <h2 className="text-5xl font-bold text-slate-700">{mod.title}</h2>
                                    <p className="text-3xl text-slate-400 mt-2">{mod.description}</p>
                                </div>
                            </button>
                        ))}
                    </div>
                </div>
            );
        }

        if (isFinished) {
            return (
                 <div className="h-screen w-screen flex flex-col items-center justify-center bg-white gap-10">
                    <IconFlame className="w-48 h-48 text-orange-500 animate-bounce" />
                    <h1 className="text-8xl font-black text-yellow-500">Good Job!</h1>
                    <button onClick={() => setView('HOME')} className="bg-blue-600 text-white px-16 py-8 rounded-full text-4xl font-bold shadow-xl flex items-center gap-4 active:scale-95">
                        <IconHome className="w-12 h-12" /> Back to Menu
                    </button>
                 </div>
            );
        }

        return (
            <div className="h-screen w-screen flex flex-col bg-white overflow-hidden">
                {/* HEADER */}
                <header className="h-24 px-8 bg-white border-b-2 border-slate-100 flex items-center gap-8 shrink-0">
                     <button onClick={() => setView('HOME')} className="p-2 bg-slate-100 rounded-xl"><IconArrowLeft className="w-10 h-10 text-slate-500" /></button>
                     <div className="flex-1 h-8 bg-slate-100 rounded-full overflow-hidden">
                        <div className="h-full bg-green-500 transition-all duration-500" style={{ width: `${progress}%` }} />
                     </div>
                     <div className="flex items-center gap-2">
                        <IconHeart className="w-12 h-12 text-red-500 fill-red-500" />
                        <span className="text-5xl font-bold text-slate-700">{hearts}</span>
                     </div>
                </header>

                {/* CONTENT AREA */}
                <main className="flex-1 flex flex-col items-center justify-center p-4 w-full max-w-[90vw] mx-auto">
                    
                    {/* BUILD */}
                    {currentLevel.type === 'build' && (
                        <div className="flex flex-col items-center justify-between h-full w-full py-4">
                            <div className="flex items-center gap-6">
                                <span className="text-7xl font-bold text-slate-800">{currentLevel.chinese}</span>
                                <button onClick={() => AudioEngine.speak(currentLevel.targetSentence)} className="p-4 bg-blue-100 rounded-full text-blue-600"><IconVolume2 className="w-12 h-12" /></button>
                            </div>
                            <div className="flex flex-wrap gap-4 min-h-[120px] items-center justify-center border-b-4 border-slate-200 w-full px-4">
                                {buildSelectedWords.map((w, i) => (
                                    <button key={i} onClick={() => {
                                        const newSel = [...buildSelectedWords]; newSel.splice(i, 1); setBuildSelectedWords(newSel);
                                    }} className="text-6xl font-bold text-slate-800 bg-white border-4 border-slate-300 px-6 py-2 rounded-2xl">{w.text}</button>
                                ))}
                            </div>
                            <div className="flex flex-wrap gap-6 justify-center">
                                {currentLevel.words.map((word, i) => {
                                    const isUsed = buildSelectedWords.some(sw => sw.index === i);
                                    return (
                                        <button key={i} disabled={isUsed} onClick={() => {
                                            setBuildSelectedWords([...buildSelectedWords, {text: word, index: i}]);
                                            AudioEngine.speak(word);
                                        }} className={`text-6xl font-bold px-10 py-6 rounded-3xl border-b-8 transition-all ${isUsed ? 'opacity-0' : 'bg-white border-slate-200 text-slate-700 active:translate-y-2'}`}>
                                            {word}
                                        </button>
                                    )
                                })}
                            </div>
                        </div>
                    )}

                    {/* MATCH */}
                    {currentLevel.type === 'match_pairs' && (
                        <div className="w-full h-full flex flex-col">
                            <h2 className="text-4xl text-slate-400 font-bold text-center mb-4">{currentLevel.prompt}</h2>
                            <div className="grid grid-cols-3 gap-6 flex-1">
                                {currentLevel.pairs.map(item => {
                                    const isSolved = matchPairsSolved.includes(item.id);
                                    const isSel = matchSelectedId === item.id;
                                    return (
                                        <button key={item.id} disabled={isSolved} onClick={() => {
                                            if (!matchSelectedId) { setMatchSelectedId(item.id); if(item.lang==='en') AudioEngine.speak(item.text); }
                                            else if (matchSelectedId === item.id) setMatchSelectedId(null);
                                            else {
                                                const prev = currentLevel.pairs.find(p=>p.id===matchSelectedId);
                                                if (prev.pairId === item.pairId) { setMatchPairsSolved([...matchPairsSolved, prev.id, item.id]); setMatchSelectedId(null); AudioEngine.playDing(); }
                                                else { setMatchSelectedId(null); AudioEngine.playBoop(); }
                                            }
                                        }} className={`rounded-3xl border-4 text-4xl font-bold flex items-center justify-center p-2 leading-tight transition-all ${isSolved ? 'opacity-20 scale-90' : isSel ? 'bg-blue-100 border-blue-500 text-blue-700' : 'bg-white border-slate-200 text-slate-700'}`}>
                                            {item.lang === 'image' ? <span className="text-8xl">{item.text}</span> : item.text}
                                        </button>
                                    )
                                })}
                            </div>
                        </div>
                    )}

                    {/* CHOICE */}
                    {(currentLevel.type === 'picture_choice' || currentLevel.type === 'audio_choice') && (
                        <div className="flex flex-col items-center justify-between h-full w-full py-2">
                             <div className="flex-1 flex items-center justify-center scale-150">
                                {currentLevel.type === 'audio_choice' && <button onClick={()=>AudioEngine.speak(currentLevel.audioText)} className="w-40 h-40 bg-blue-500 rounded-3xl flex items-center justify-center text-white"><IconVolume2 className="w-20 h-20"/></button>}
                                {currentLevel.iconType === 'green_light' && <TrafficLightGreen />}
                                {currentLevel.iconType === 'question' && <span className="text-9xl">‚ùì</span>}
                             </div>
                             <div className="grid grid-cols-3 gap-6 w-full mt-8">
                                {currentLevel.options.map(opt => (
                                    <button key={opt.id} onClick={() => { setChoiceSelectedId(opt.id); if(opt.text) AudioEngine.speak(opt.text); }} 
                                    className={`py-8 rounded-3xl border-8 text-4xl font-bold transition-all ${choiceSelectedId === opt.id ? 'bg-blue-600 text-white border-blue-800' : 'bg-white border-slate-200 text-slate-700'}`}>
                                        {opt.text}
                                    </button>
                                ))}
                             </div>
                        </div>
                    )}

                    {/* COLOR REACTION */}
                    {currentLevel.type === 'color_reaction' && (
                        <div className="flex flex-col items-center justify-center h-full w-full gap-10">
                             <h2 className="text-8xl font-black text-slate-800 animate-bounce">{currentLevel.prompt}</h2>
                             <div className="flex gap-12 w-full max-w-5xl h-64">
                                <button onClick={() => currentLevel.targetColor === 'red' ? handleSuccess() : handleError()} className="flex-1 bg-red-500 rounded-[3rem] border-b-[16px] border-red-800 shadow-2xl active:translate-y-4 active:border-b-0 flex items-center justify-center group">
                                    <div className="w-40 h-40 rounded-full bg-red-400 animate-pulse group-hover:bg-red-300" />
                                </button>
                                <button onClick={() => currentLevel.targetColor === 'green' ? handleSuccess() : handleError()} className="flex-1 bg-green-500 rounded-[3rem] border-b-[16px] border-green-800 shadow-2xl active:translate-y-4 active:border-b-0 flex items-center justify-center group">
                                    <div className="w-40 h-40 rounded-full bg-green-400 animate-pulse group-hover:bg-green-300" />
                                </button>
                             </div>
                        </div>
                    )}

                    {/* TRACING */}
                    {currentLevel.type === 'tracing' && (
                        <div className="relative w-full h-full max-h-[65vh] aspect-square bg-white rounded-[3rem] border-8 border-slate-200 overflow-hidden shadow-inner mx-auto">
                            <div className="absolute inset-0 flex flex-col justify-center pointer-events-none opacity-30">
                                <div className="w-full border-b-4 border-slate-400 border-dashed mb-[140px]"></div>
                                <div className="w-full border-b-4 border-red-400 mb-[140px]"></div>
                                <div className="w-full border-b-4 border-slate-400 border-dashed"></div>
                            </div>
                            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-[400px] font-serif text-slate-200 pointer-events-none select-none leading-none pt-8">
                                {currentLevel.letter}
                            </div>
                            <canvas ref={canvasRef} width={800} height={800} className="absolute inset-0 w-full h-full cursor-crosshair z-10"
                                onMouseDown={startDrawing} onMouseMove={draw} onMouseUp={stopDrawing} onMouseLeave={stopDrawing}
                                onTouchStart={startDrawing} onTouchMove={draw} onTouchEnd={stopDrawing}
                            />
                            <button onClick={()=>{
                                const ctx = canvasRef.current.getContext('2d'); ctx.clearRect(0,0,800,800); setCanvasHasDrawing(false);
                            }} className="absolute bottom-4 right-4 bg-slate-200 p-4 rounded-full z-20"><IconEraser className="w-10 h-10 text-slate-600" /></button>
                        </div>
                    )}

                    {/* MISSING LETTER */}
                    {currentLevel.type === 'missing_letter' && (
                        <div className="flex flex-col items-center justify-center h-full w-full gap-12">
                            <div className="flex items-end gap-2">
                                <span className="text-[8rem] font-mono text-slate-400 leading-none">{currentLevel.displayWord.split('_')[0]}</span>
                                <span className="text-[8rem] font-bold text-blue-600 border-b-8 border-blue-600 min-w-[120px] text-center leading-none">{choiceSelectedId || '?'}</span>
                                <span className="text-[8rem] font-mono text-slate-400 leading-none">{currentLevel.displayWord.split('_')[1]}</span>
                            </div>
                            <div className="flex gap-8">
                                {currentLevel.options.map(opt => (
                                    <button key={opt} onClick={() => setChoiceSelectedId(opt)} className={`w-32 h-32 rounded-3xl text-6xl font-bold border-b-8 transition-all ${choiceSelectedId === opt ? 'bg-blue-500 text-white border-blue-700' : 'bg-white border-slate-200'}`}>
                                        {opt}
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}

                </main>

                {/* FOOTER */}
                <footer className="h-28 px-8 bg-white border-t border-slate-100 flex items-center justify-between shrink-0">
                    <div className="text-4xl font-bold">
                        {status === 'correct' && <span className="text-green-500 flex items-center gap-2"><IconCheck className="w-10 h-10"/> Great!</span>}
                        {status === 'wrong' && <span className="text-red-500 flex items-center gap-2"><IconX className="w-10 h-10"/> Try Again</span>}
                    </div>
                    {status !== 'idle' && (
                        <button onClick={checkAnswer} className={`px-16 py-4 rounded-3xl text-3xl font-black text-white uppercase shadow-lg active:scale-95 transition-all ${status === 'correct' ? 'bg-green-500' : 'bg-red-500'}`}>
                            Next Level
                        </button>
                    )}
                    {status === 'idle' && currentLevel.type !== 'color_reaction' && (
                        <button onClick={checkAnswer} className="px-16 py-4 rounded-3xl text-3xl font-black text-white uppercase bg-green-500 shadow-lg active:scale-95 transition-all">
                            Check
                        </button>
                    )}
                </footer>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
    </script>
</body>
</html>
